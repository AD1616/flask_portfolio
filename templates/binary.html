{% extends "layouts/base.html" %}

<!-- Search for all the Hack: below for hack-a-thon and mini-lab requirements -->
<!-- need to adjust Templates to start -->

<!-- Hack: Build form to drive bit size dynamic updates
           use HTML Input Form in Frontend, ie toward top of Page
           send initial value and updated values to form via Python render_template -->
<!-- Hack: use 8 as default -->
{% set BITS = 12 %}
{% set MAX = ((2 ** BITS) - 1) %}

<!-- Hack: Set bulbs and pass as variables via Python render_template
           add new images (ie PNGs) to project -->
<!-- use your PNGs as default -->
{% set imgBulbOn = "http://clipart-library.com/data_images/123832.png" %}
{% set imgBulbOff = "data:image/png;base64,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" %}
{% set msgTurnOn = "Turn On" %}
{% set msgTurnOff = "Turn Off" %}

{% block meta %}
    <title>Binary page</title>
    <script>
        const BITS = '{{ BITS }}'; let max = '{{ MAX }}'; let MAX = parseInt(max, 10);
        // return string with current value of each bit
        function getBits() {
            let bits = "";
            for(let i = 0; i < BITS; i++) {
                bits = bits + document.getElementById('digit' + i).value;
            }
            return bits;
        }
        // setter for DOM values
        function setConversions(binary) {
            document.getElementById('binary').innerHTML = binary;
            // DOM assignment to Octal conversion
            document.getElementById('octal').innerHTML = parseInt(binary, 2).toString(8);
            // DOM assignment to Hexadecimal conversion
            document.getElementById('hexadecimal').innerHTML = parseInt(binary, 2).toString(16);
            // DOM assignment to Decimal conversion
            document.getElementById('decimal').innerHTML = parseInt(binary, 2).toString(10);
            /* Hack: show ASCII printable character(s) for each 8 bits
             DOM assignment by converting decimal https://www.w3schools.com/jsref/jsref_fromcharcode.asp
             below ASCII for more ideas of where to make changes
             */
        }

        // algorithm to convert decimal to base using division and remainder
        function decimal_2_base(decimal, base) {
            let conversion = "";
            // loop to convert to base
            do {
                let digit = decimal % base;
                conversion = "" + digit + conversion; // what does this do?
                decimal = ~~(decimal / base);         // what does this do?  what is ~~?
            } while (decimal > 0);                  // why while at the end?
            // loop to pad with zeros
            if (base === 2) {                        // only pad for binary conversions
                for (let i = 0; conversion.length < BITS; i++) {
                    conversion = "0" + conversion;
                }
            }
            return conversion;
        }

        // toggle selected bit and recalculate
        function toggleBit(i) {
            //alert("Digit action: " + i );
            const dig = document.getElementById('digit' + i);
            const image = document.getElementById('bulb' + i);
            const butt = document.getElementById('butt' + i);
            // Change digit and visual
            if (image.src.match("{{ imgBulbOn }}")) {
                dig.value = 0;
                image.src = "{{ imgBulbOff }}";
                butt.innerHTML = "{{ msgTurnOn }}";
            } else {
                dig.value = 1;
                image.src = "{{ imgBulbOn }}";
                butt.innerHTML = "{{ msgTurnOff }}";
            }
            // Binary numbers
            const binary = getBits();
            setConversions(binary);
        }
        // add is positive integer, subtract is negative integer
        function add(n) {
            let binary = getBits();
            // convert to decimal and do math
            let decimal = parseInt(binary, 2);
            if (n > 0) {  // PLUS
                decimal = MAX === decimal ? 0 : decimal += n; // OVERFLOW or PLUS
            } else  {     // MINUS
                decimal = 0 === decimal ? MAX : decimal += n; // OVERFLOW or MINUS
            }
            // convert the result back to binary
            binary = decimal_2_base(decimal, 2);
            // update conversions
            setConversions(binary);
            // update bits
            for (let i = 0; i < binary.length; i++) {
                let digit = binary.substr(i, 1);
                document.getElementById('digit' + i).value = digit;
                if (digit === "1") {
                    document.getElementById('bulb' + i).src = "{{ imgBulbOn }}";
                    document.getElementById('butt' + i).innerHTML = "{{ msgTurnOff }}";
                } else {
                    document.getElementById('bulb' + i).src = "{{ imgBulbOff }}";
                    document.getElementById('butt' + i).innerHTML = "{{ msgTurnOn }}";
                }
            }
        }
    </script>
{% endblock %}

{% block content %}
    <h1 class="text-center">Binary Math with Conversions</h1>
    <div class="container">
        <div class="row justify-content-md-center">

            <div class="col-8">
                <table class="table">
                    <tr id="table">
                        <th>Plus</th>
                        <th>Binary</th>
                        <th>Octal</th>
                        <th>Hexadecimal</th>
                        <th>Decimal</th>
                        <!-- Hack: display ASCII label for printable character(s)  -->
                        <th>Minus</th>
                    </tr>
                    <tr>
                        <td><button type="button" id="add1" onclick="add(1)">+1</button></td>
                        <td id="binary">00000000</td>
                        <td id="octal">0</td>
                        <td id="hexadecimal">0</td>
                        <td id="decimal">0</td>
                        <!-- Hack: display ASCII printable character(s)  -->
                        <td><button type="button" id="sub1" onclick="add(-1)">-1</button></td>

                    </tr>
                </table>
            </div>

            <div class="col-12">
                <table class="table">
                    <tr>
                        {% for i in range(BITS) %}
                            <td><img class="img-responsive py-3" id="bulb{{i}}" src="{{ imgBulbOff }}" alt="" width="40" height="Auto">
                                <button type="button" id="butt{{i}}" onclick="toggleBit('{{i}}')">{{ msgTurnOn }}</button>
                            </td>
                        {% endfor %}
                    </tr>
                    <tr>
                        {% for i in range(BITS) %}
                            <td><input type='text' id='digit{{i}}' Value="0" size="1" readonly></td>
                        {% endfor %}
                    </tr>
                </table>
            </div>

        </div>
    </div>
{% endblock %}